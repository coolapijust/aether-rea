services:
  # Aether 核心服务端 (Host 直连模式 + 多态伪装挂载)
  # 彻底移除 Caddy 代理层，由 Backend 直接处理 TLS 和 443 端口
  aether-backend:
    image: ghcr.io/coolapijust/aether-realist:main
    container_name: aether-gateway-core
    restart: always
    network_mode: host
    environment:
      - PSK=${PSK}
      - LISTEN_ADDR=:${CADDY_PORT}
      - SSL_CERT_FILE=${CERT_FILE:-/certs/server.crt}
      - SSL_KEY_FILE=${KEY_FILE:-/certs/server.key}
      - DECOY_ROOT=/decoy
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /etc/timezone:/etc/timezone:ro
      - ./certs:/certs:ro
      - ${DECOY_PATH}:/decoy:ro
    cap_add:
      - NET_ADMIN
