# Aether-Realist 设计文档 (架构、安全与性能)

本文档深入介绍 Aether-Realist V3 版本的核心设计哲学、系统架构以及在安全与性能方面的优化实践。

---

## 1. 核心架构 (Architecture)

Aether-Realist 采用 **Core-Daemon-GUI** 分离的设计架构，确保了核心逻辑的稳定性与前端界面的高度解耦。

### 1.1 系统组件
- **Aether Core (internal/core)**: 协议的核心实现，负责 WebTransport 会话管理、分段混淆、流式背压控制以及规则匹配。
- **Aether Daemon (aetherd)**: 基于 Core 开发的后台进程，提供 SOCKS5 代理接口和 WebSocket 管理接口。
- **Tauri GUI (gui/)**: 基于 React + TypeScript 的现代化界面，通过 WebSocket 异步订阅 Core 的所有事件（日志、指标、状态变化）。

### 1.2 事件驱动通信 (Event-Driven)
GUI 与守护进程之间不采用轮询，而是通过全双工的 WebSocket 进行通信：
- **实时指标**: 每秒推送流量快照，前端绘制平滑曲线。
- **异步日志**: 通过劫持 Go 标准日志流，实现服务端行为在客户端的实时可视化。
- **状态流**: 核心引擎的 FSM（有限状态机）变化实时同步，确保 UI 状态严格反映后端真实连接情况。

---

## 2. 安全机制 (Security)

安全是 Aether-Realist 的生命线。我们从协议层到部署层提供了多维度的加固。

### 2.1 主动探测防御 (Active Probe Defense)
在生产部署中，利用 Caddy 的强大匹配能力实现“主动拒绝”：
- **指纹匹配**: 只有携带特定协议头（如 `Upgrade: webtransport`）的请求才会被转发。
- **陷阱响应**: 非法探测（如浏览器直接访问 API 路径）将收到诱导性的 401 JSON 错误，模拟一个不存在的私有服务，增加攻击者的测向难度。

### 2.2 深度伪装 (Decoy System)
通过 Caddy 的回落机制：
- **默认站点**: 任何不满足 Aether 协议特征的流量都会被路由到一个极其“正经”的 **Decoy Site**（通常是一个伪装的技术文档站）。
- **静态资源隔离**: 伪装站运行在独立的 Nginx 容器中，与核心业务完全隔离。

### 2.3 协议层安全
- **元数据加密**: 采用 `AES-128-GCM` 对目标地址进行加密，密钥通过 HKDF 从 PSK 派生，且每个流的密钥随机化。
- **定期轮换 (Session Rotation)**: 客户端根据时间或流量特征定期重建 WebTransport 连接，防止长连接引起的流量指纹积累。

---

## 3. 性能优化 (Performance)

### 3.1 HTTP/3 (QUIC) 优势
- **0-RTT 建连**: 极速恢复连接。
- **无队头阻塞**: 单个流丢包不影响其他并发连接。
- **连接迁移**: 在蜂窝网络与 WiFi 切换时保持 SOCKS5 连接不中断。

### 3.2 零延迟系统代理 (Windows)
在 Windows 平台上，我们直接调用 `WinInet.dll` 的原生 API：
- **InternetSetOption**: 修改注册表后立即通过系统调用刷新 OID 缓存，实现在开启代理的瞬间，所有浏览器无需重启即可立即生效。

### 3.3 高性能匹配引擎
- **路由决策**: 内部实现了基于前缀树（Trie）的域名匹配和 CIDR 匹配，规则量在万级时仍能保持微秒级判定。
- **流式背压**: 完全基于 Go 的接口导向设计，确保在大流量下 CPU 负载极低且内存占用稳定。
